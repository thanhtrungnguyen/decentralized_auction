{
  "language": "Solidity",
  "sources": {
    "contracts/Auction.sol": {
      "content": "// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\nerror Auction__InvalidRegistrationTime();\r\nerror Auction__InvalidAuctionTime();\r\nerror Auction__InvalidDuePaymentTime();\r\nerror Auction__InvalidStartAuctionTime();\r\nerror Auction__InvalidRegistrationFee();\r\nerror Auction__InvalidDepositAmount();\r\nerror Auction__InvalidStartBid();\r\nerror Auction__InvalidPriceStep();\r\nerror Auction__InvalidDatetime();\r\nerror Auction__InvalidAuctionId();\r\nerror Auction__OutOfRegistrationTime();\r\nerror Auction__RequireAmountToRegisterNotMet(uint256 auctionId, uint256 requireAmountToRegister);\r\nerror Auction__OutOfAuctionTime();\r\nerror Auction__InvalidBidAmount();\r\nerror Auction__NotRegisteredBidder();\r\n\r\ncontract Auction {\r\n    uint256[] private s_auctionList;\r\n    uint16 private constant CONFIRMATION_TIME = 300;\r\n\r\n    struct AuctionInfomation {\r\n        uint256 startRegistrationTime;\r\n        uint256 endRegistrationTime;\r\n        uint256 startAuctionTime;\r\n        uint256 endAuctionTime;\r\n        uint256 duePaymentTime;\r\n        uint256 registrationFee;\r\n        uint256 depositAmount;\r\n        uint256 startBid;\r\n        uint256 priceStep;\r\n    }\r\n\r\n    struct BidInfomation {\r\n        address bidder;\r\n        uint256 bidAmount;\r\n    }\r\n\r\n    event CreatedAuction(\r\n        uint256 auctionId,\r\n        uint256 startRegistrationTime,\r\n        uint256 endRegistrationTime,\r\n        uint256 startAuctionTime,\r\n        uint256 endAuctionTime,\r\n        uint256 duePaymentTime,\r\n        uint256 registrationFee,\r\n        uint256 depositAmount,\r\n        uint256 startBid,\r\n        uint256 priceStep\r\n    );\r\n    event PlacedBid(uint256 auctionId, address bidder, uint256 bidAmount);\r\n    event RegisteredToBid(uint256 auctionId, address bidder);\r\n\r\n    mapping(uint256 => AuctionInfomation) public s_auctionInfomations;\r\n    mapping(uint256 => BidInfomation[]) public s_bidInfomations;\r\n    // mapping(uint256 => BidInfomation[])\r\n\r\n    modifier isVailidAuctionId(uint256 auctionId) {\r\n        for (uint256 i = 0; i < s_auctionList.length; i++) {\r\n            if (auctionId == s_auctionList[i]) {\r\n                revert Auction__InvalidAuctionId();\r\n            }\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidRegistrationTime(uint256 startRegistrationTime, uint256 endRegistrationTime) {\r\n        if (\r\n            startRegistrationTime < block.timestamp ||\r\n            // block.timestamp > endRegistrationTime ||\r\n            startRegistrationTime >= endRegistrationTime\r\n        ) {\r\n            revert Auction__InvalidRegistrationTime();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidStartAuctionTime(uint256 endRegistrationTime, uint256 startAuctionTime) {\r\n        if (endRegistrationTime >= startAuctionTime) {\r\n            revert Auction__InvalidStartAuctionTime();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidAuctionTime(uint256 startAuctionTime, uint256 endAuctionTime) {\r\n        if (startAuctionTime >= endAuctionTime) {\r\n            revert Auction__InvalidAuctionTime();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidDuePaymentTime(uint256 endAuctionTime, uint256 duePaymentTime) {\r\n        if (endAuctionTime >= duePaymentTime) {\r\n            revert Auction__InvalidDuePaymentTime();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidRegistrationFee(uint256 registrationFee) {\r\n        if (registrationFee <= 0) {\r\n            revert Auction__InvalidRegistrationFee();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidDepositAmount(uint256 depositAmount) {\r\n        if (depositAmount <= 0) {\r\n            revert Auction__InvalidDepositAmount();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidStartBid(uint256 depositAmount) {\r\n        if (depositAmount <= 0) {\r\n            revert Auction__InvalidStartBid();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isValidPriceStep(uint256 depositAmount) {\r\n        if (depositAmount <= 0) {\r\n            revert Auction__InvalidPriceStep();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isAuctionExist(uint256 auctionId) {\r\n        uint256 count;\r\n        for (uint256 i = 0; i < s_auctionList.length; i++) {\r\n            count++;\r\n        }\r\n        if (count == s_auctionList.length) {\r\n            revert Auction__InvalidAuctionId();\r\n        }\r\n        _;\r\n    }\r\n\r\n    modifier isRegistrationTime(uint256 auctionId) {\r\n        if (\r\n            s_auctionInfomations[auctionId].startRegistrationTime < block.timestamp ||\r\n            s_auctionInfomations[auctionId].endRegistrationTime > block.timestamp\r\n        ) {\r\n            revert Auction__OutOfRegistrationTime();\r\n        }\r\n        _;\r\n    }\r\n    modifier isAuctionTime(uint256 auctionId) {\r\n        if (s_auctionInfomations[auctionId].startAuctionTime < block.timestamp || s_auctionInfomations[auctionId].endAuctionTime > block.timestamp) {\r\n            revert Auction__OutOfAuctionTime();\r\n        }\r\n        _;\r\n    }\r\n    modifier isValidBidAmount(uint256 auctionId, uint256 bidAmount) {\r\n        if (\r\n            bidAmount < s_auctionInfomations[auctionId].depositAmount ||\r\n            bidAmount < getHightestBidOfAuction(auctionId) + s_auctionInfomations[auctionId].priceStep\r\n        ) {\r\n            revert Auction__InvalidBidAmount();\r\n        }\r\n        _;\r\n    }\r\n    modifier isRegisteredBidder(uint256 auctionId) {\r\n        uint256 count = 0;\r\n        for (uint256 i = 0; i < s_bidInfomations[auctionId].length; i++) {\r\n            if (s_bidInfomations[auctionId][i].bidder != msg.sender) {\r\n                count++;\r\n            }\r\n        }\r\n        if (count == s_bidInfomations[auctionId].length) {\r\n            revert Auction__NotRegisteredBidder();\r\n        }\r\n        _;\r\n    }\r\n\r\n    function isValidatedInput(\r\n        uint256 auctionId, //need validate\r\n        uint256 startRegistrationTime,\r\n        uint256 endRegistrationTime,\r\n        uint256 startAuctionTime,\r\n        uint256 endAuctionTime,\r\n        uint256 duePaymentTime,\r\n        uint256 registrationFee,\r\n        uint256 depositAmount,\r\n        uint256 startBid,\r\n        uint256 priceStep\r\n    )\r\n        internal\r\n        view\r\n        isVailidAuctionId(auctionId)\r\n        isValidRegistrationTime(startRegistrationTime, endRegistrationTime)\r\n        isValidStartAuctionTime(endRegistrationTime, startAuctionTime)\r\n        isValidAuctionTime(startAuctionTime, endAuctionTime)\r\n        isValidDuePaymentTime(endAuctionTime, duePaymentTime)\r\n        isValidRegistrationFee(registrationFee)\r\n        isValidDepositAmount(depositAmount)\r\n        isValidStartBid(startBid)\r\n        isValidPriceStep(priceStep)\r\n        returns (bool)\r\n    {\r\n        return true;\r\n    }\r\n\r\n    function createAuction(\r\n        uint256 auctionId,\r\n        uint256 startRegistrationTime,\r\n        uint256 endRegistrationTime,\r\n        uint256 startAuctionTime,\r\n        uint256 endAuctionTime,\r\n        uint256 duePaymentTime,\r\n        uint256 registrationFee,\r\n        uint256 depositAmount,\r\n        uint256 startBid,\r\n        uint256 priceStep\r\n    ) external payable {\r\n        if (\r\n            isValidatedInput(\r\n                auctionId,\r\n                startRegistrationTime,\r\n                endRegistrationTime,\r\n                startAuctionTime,\r\n                endAuctionTime,\r\n                duePaymentTime,\r\n                registrationFee,\r\n                depositAmount,\r\n                startBid,\r\n                priceStep\r\n            )\r\n        ) {\r\n            AuctionInfomation memory auction;\r\n            auction.startRegistrationTime = startRegistrationTime;\r\n            auction.endRegistrationTime = endRegistrationTime;\r\n            auction.startAuctionTime = startAuctionTime;\r\n            auction.endAuctionTime = endAuctionTime;\r\n            auction.duePaymentTime = duePaymentTime;\r\n            auction.registrationFee = registrationFee;\r\n            auction.depositAmount = depositAmount;\r\n            auction.startBid = startBid;\r\n            auction.priceStep = priceStep;\r\n            s_auctionInfomations[auctionId] = auction;\r\n            s_auctionList.push(auctionId);\r\n\r\n            emit CreatedAuction(\r\n                auctionId,\r\n                startRegistrationTime,\r\n                endRegistrationTime,\r\n                startAuctionTime,\r\n                endAuctionTime,\r\n                duePaymentTime,\r\n                registrationFee,\r\n                depositAmount,\r\n                startBid,\r\n                priceStep\r\n            );\r\n        }\r\n    }\r\n\r\n    function registerToBid(uint256 auctionId) external payable isVailidAuctionId(auctionId) isRegistrationTime(auctionId) {\r\n        uint256 requireAmountToRegister = s_auctionInfomations[auctionId].registrationFee + s_auctionInfomations[auctionId].depositAmount;\r\n        if (msg.value < requireAmountToRegister) {\r\n            revert Auction__RequireAmountToRegisterNotMet(auctionId, requireAmountToRegister);\r\n        }\r\n        s_bidInfomations[auctionId][s_bidInfomations[auctionId].length].bidder = msg.sender;\r\n        emit RegisteredToBid(auctionId, msg.sender);\r\n    }\r\n\r\n    function getHightestBidOfAuction(uint256 auctionId) public view returns (uint256) {\r\n        uint256 highestBid = 0;\r\n        for (uint256 i = 0; i < s_bidInfomations[auctionId].length; i++) {\r\n            if (s_bidInfomations[auctionId][i].bidAmount > highestBid) {\r\n                highestBid = s_bidInfomations[auctionId][i].bidAmount;\r\n            }\r\n        }\r\n        return highestBid;\r\n    }\r\n\r\n    function getIndexOfBidder(uint256 auctionId) public view returns (uint256) {\r\n        for (uint256 i = 0; i < s_bidInfomations[auctionId].length; i++) {\r\n            if (s_bidInfomations[auctionId][i].bidder == msg.sender) {\r\n                return i;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    function placeBid(uint256 auctionId, uint256 bidAmount)\r\n        external\r\n        payable\r\n        isAuctionExist(auctionId)\r\n        isAuctionTime(auctionId)\r\n        isRegisteredBidder(auctionId)\r\n        isValidBidAmount(auctionId, bidAmount)\r\n    {\r\n        s_bidInfomations[auctionId][getIndexOfBidder(auctionId)].bidAmount = bidAmount;\r\n        emit PlacedBid(auctionId, msg.sender, bidAmount);\r\n    }\r\n\r\n    function closeAuction() external {}\r\n\r\n    function withdaw() external {}\r\n\r\n    function getListAuctionId() external view returns (uint256[] memory) {\r\n        return s_auctionList;\r\n    }\r\n    // function getAuction(uint256 auctionId) external view returns (AuctionInfomation memory) {\r\n    //     return s_auctionInfomations[auctionId];\r\n    // }\r\n\r\n    // function getRankOfAuction\r\n}\r\n"
    }
  },
  "settings": {
    "optimizer": {
      "enabled": false,
      "runs": 200
    },
    "outputSelection": {
      "*": {
        "*": [
          "abi",
          "evm.bytecode",
          "evm.deployedBytecode",
          "evm.methodIdentifiers",
          "metadata",
          "devdoc",
          "userdoc",
          "storageLayout",
          "evm.gasEstimates"
        ],
        "": [
          "ast"
        ]
      }
    },
    "metadata": {
      "useLiteralContent": true
    }
  }
}